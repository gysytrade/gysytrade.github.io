---
import { getCollection } from 'astro:content';
import Layout from '../../../layouts/Layout.astro';
import { useTranslations } from '../../../i18n/utils';

export async function getStaticPaths() {
  const newsEntries = await getCollection('news');
  return newsEntries.map(entry => {
    // entry.slug is like 'en/opening' or 'zh/logistics'
    const [lang, ...slugParts] = entry.slug.split('/');
    const slug = slugParts.join('/');
    return {
      params: { lang, slug },
      props: { entry },
    };
  });
}

const { entry } = Astro.props;
const { Content } = await entry.render();
const { lang } = Astro.params;
const t = useTranslations(lang as any);

const formattedDate = entry.data.date.toLocaleDateString(lang, {
  year: 'numeric',
  month: 'long',
  day: 'numeric'
});
---

<Layout title={`${entry.data.title} - Guangyuan Shengyuan`}>
  <div class="bg-primary pt-32 pb-16 text-white text-center">
    <div class="container max-w-4xl">
      <div class="text-accent font-bold tracking-wider uppercase text-sm mb-4">News & Updates</div>
      <h1 class="text-3xl md:text-5xl font-bold font-serif mb-6 leading-tight">{entry.data.title}</h1>
      <div class="text-gray-300">{formattedDate}</div>
    </div>
  </div>

  <article class="py-20 bg-white">
    <div class="container max-w-3xl prose prose-lg prose-slate prose-headings:font-serif prose-headings:text-primary prose-a:text-accent">
      <div class="bg-slate-50 p-6 rounded-xl border-l-4 border-accent mb-10 text-gray-600 italic">
        {entry.data.description}
      </div>
      <Content />
      
      <div class="mt-16 pt-8 border-t border-gray-100 flex justify-between items-center">
        <a href={`/${lang}/`} class="btn-secondary flex items-center gap-2 group">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 transform group-hover:-translate-x-1 transition-transform" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18" />
          </svg>
          Back to Home
        </a>
      </div>
    </div>
  </article>
</Layout>
